{"version":3,"file":"angular-file-validator.umd.js","sources":["../../../projects/ng-file-validator-lib/src/lib/file-validator.service.ts","../../../projects/ng-file-validator-lib/src/lib/ng-file-validator-lib.module.ts","../../../projects/ng-file-validator-lib/src/public-api.ts","../../../projects/ng-file-validator-lib/src/angular-file-validator.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { AbstractControl, AsyncValidatorFn } from \"@angular/forms\";\nimport { Observable, Observer, of } from \"rxjs\";\n\n\n@Injectable()\nexport class FileCheck {\n\n\n\n  static ngFileValidator(allowedType: String[] = []): AsyncValidatorFn {\n    let x = 10 + 1;\n    return (control: AbstractControl): Promise<{ [key: string]: any }> | Observable<{ [key: string]: any }> => {\n      if (typeof (control.value) === 'string') {\n        return of(null);\n      }\n\n      if (allowedType.length < 1) {\n        return of({ invalidMimeType: true })\n      }\n\n      if (allowedType.indexOf('jpg') !== -1) {\n        const fileTypeIndex = allowedType.indexOf('jpg')\n        allowedType[fileTypeIndex] = 'jpeg'\n      }\n\n      const file = control.value as File;\n      const fileReader = new FileReader();\n      let fileTye = ''\n      const frObs = Observable.create(\n        (observer: Observer<{ [key: string]: any }>) => {\n          fileReader.addEventListener(\"loadend\", () => {\n            const arr = new Uint8Array(fileReader.result as ArrayBuffer).subarray(0, 4);\n            let header = \"\";\n\n            for (let i = 0; i < arr.length; i++) {\n              header += arr[i].toString(16);\n            }\n            switch (header) {\n              case \"89504e47\": //   type = \"image/png\";\n                fileTye = 'png'\n                break;\n              case \"ffd8ffe0\":\n              case \"ffd8ffe1\":\n              case \"ffd8ffe2\":\n              case \"ffd8ffe3\":\n              case \"ffd8ffe8\":\n                fileTye = 'jpeg'   //   type = \"image/jpeg\";\n                break;\n              case \"47494638\":\n                fileTye = 'gif'  //   type = \"image/gif\";\n                break;\n              default:\n\n                fileTye = 'others' // Or you can use the blob.type as fallback\n                break;\n            }\n            if (allowedType.includes(fileTye)) {\n              observer.next(null);\n            } else {\n              observer.next({ invalidMimeType: true });\n            }\n            observer.complete();\n          });\n          fileReader.readAsArrayBuffer(file);\n        }\n      );\n      return frObs;\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { FileCheck } from './file-validator.service';\n\n\n@NgModule({\n  providers: [FileCheck]\n})\nexport class NgFileValidatorLibModule { }\n","/*\n * Public API Surface of ng-file-validator-lib\n */\n\nexport * from './lib/ng-file-validator-lib.module';\nexport * from './lib/file-validator.service';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":["of","Observable","Injectable","NgModule"],"mappings":";;;;;;;QAMA;;QAIS,yBAAe,GAAtB,UAAuB,WAA0B;YAA1B,4BAAA,EAAA,gBAA0B;YAC/C,IAAI,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;YACf,OAAO,UAAC,OAAwB;gBAC9B,IAAI,QAAQ,OAAO,CAAC,KAAK,CAAC,KAAK,QAAQ,EAAE;oBACvC,OAAOA,OAAE,CAAC,IAAI,CAAC,CAAC;iBACjB;gBAED,IAAI,WAAW,CAAC,MAAM,GAAG,CAAC,EAAE;oBAC1B,OAAOA,OAAE,CAAC,EAAE,eAAe,EAAE,IAAI,EAAE,CAAC,CAAA;iBACrC;gBAED,IAAI,WAAW,CAAC,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,EAAE;oBACrC,IAAM,aAAa,GAAG,WAAW,CAAC,OAAO,CAAC,KAAK,CAAC,CAAA;oBAChD,WAAW,CAAC,aAAa,CAAC,GAAG,MAAM,CAAA;iBACpC;gBAED,IAAM,IAAI,GAAG,OAAO,CAAC,KAAa,CAAC;gBACnC,IAAM,UAAU,GAAG,IAAI,UAAU,EAAE,CAAC;gBACpC,IAAI,OAAO,GAAG,EAAE,CAAA;gBAChB,IAAM,KAAK,GAAGC,eAAU,CAAC,MAAM,CAC7B,UAAC,QAA0C;oBACzC,UAAU,CAAC,gBAAgB,CAAC,SAAS,EAAE;wBACrC,IAAM,GAAG,GAAG,IAAI,UAAU,CAAC,UAAU,CAAC,MAAqB,CAAC,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;wBAC5E,IAAI,MAAM,GAAG,EAAE,CAAC;wBAEhB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;4BACnC,MAAM,IAAI,GAAG,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;yBAC/B;wBACD,QAAQ,MAAM;4BACZ,KAAK,UAAU;gCACb,OAAO,GAAG,KAAK,CAAA;gCACf,MAAM;4BACR,KAAK,UAAU,CAAC;4BAChB,KAAK,UAAU,CAAC;4BAChB,KAAK,UAAU,CAAC;4BAChB,KAAK,UAAU,CAAC;4BAChB,KAAK,UAAU;gCACb,OAAO,GAAG,MAAM,CAAA;gCAChB,MAAM;4BACR,KAAK,UAAU;gCACb,OAAO,GAAG,KAAK,CAAA;gCACf,MAAM;4BACR;gCAEE,OAAO,GAAG,QAAQ,CAAA;gCAClB,MAAM;yBACT;wBACD,IAAI,WAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAE;4BACjC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;yBACrB;6BAAM;4BACL,QAAQ,CAAC,IAAI,CAAC,EAAE,eAAe,EAAE,IAAI,EAAE,CAAC,CAAC;yBAC1C;wBACD,QAAQ,CAAC,QAAQ,EAAE,CAAC;qBACrB,CAAC,CAAC;oBACH,UAAU,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC;iBACpC,CACF,CAAC;gBACF,OAAO,KAAK,CAAC;aACd,CAAA;SACF;;;;gBAhEFC,eAAU;;;;QCEX;;;;;gBAHCC,aAAQ,SAAC;oBACR,SAAS,EAAE,CAAC,SAAS,CAAC;iBACvB;;;ICND;;;;ICAA;;;;;;;;;;;;;;;"}