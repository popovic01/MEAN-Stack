{"version":3,"file":"angular-file-validator.js","sources":["../../../projects/ng-file-validator-lib/src/lib/file-validator.service.ts","../../../projects/ng-file-validator-lib/src/lib/ng-file-validator-lib.module.ts","../../../projects/ng-file-validator-lib/src/public-api.ts","../../../projects/ng-file-validator-lib/src/angular-file-validator.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { AbstractControl, AsyncValidatorFn } from \"@angular/forms\";\nimport { Observable, Observer, of } from \"rxjs\";\n\n\n@Injectable()\nexport class FileCheck {\n\n\n\n  static ngFileValidator(allowedType: String[] = []): AsyncValidatorFn {\n    let x = 10 + 1;\n    return (control: AbstractControl): Promise<{ [key: string]: any }> | Observable<{ [key: string]: any }> => {\n      if (typeof (control.value) === 'string') {\n        return of(null);\n      }\n\n      if (allowedType.length < 1) {\n        return of({ invalidMimeType: true })\n      }\n\n      if (allowedType.indexOf('jpg') !== -1) {\n        const fileTypeIndex = allowedType.indexOf('jpg')\n        allowedType[fileTypeIndex] = 'jpeg'\n      }\n\n      const file = control.value as File;\n      const fileReader = new FileReader();\n      let fileTye = ''\n      const frObs = Observable.create(\n        (observer: Observer<{ [key: string]: any }>) => {\n          fileReader.addEventListener(\"loadend\", () => {\n            const arr = new Uint8Array(fileReader.result as ArrayBuffer).subarray(0, 4);\n            let header = \"\";\n\n            for (let i = 0; i < arr.length; i++) {\n              header += arr[i].toString(16);\n            }\n            switch (header) {\n              case \"89504e47\": //   type = \"image/png\";\n                fileTye = 'png'\n                break;\n              case \"ffd8ffe0\":\n              case \"ffd8ffe1\":\n              case \"ffd8ffe2\":\n              case \"ffd8ffe3\":\n              case \"ffd8ffe8\":\n                fileTye = 'jpeg'   //   type = \"image/jpeg\";\n                break;\n              case \"47494638\":\n                fileTye = 'gif'  //   type = \"image/gif\";\n                break;\n              default:\n\n                fileTye = 'others' // Or you can use the blob.type as fallback\n                break;\n            }\n            if (allowedType.includes(fileTye)) {\n              observer.next(null);\n            } else {\n              observer.next({ invalidMimeType: true });\n            }\n            observer.complete();\n          });\n          fileReader.readAsArrayBuffer(file);\n        }\n      );\n      return frObs;\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { FileCheck } from './file-validator.service';\n\n\n@NgModule({\n  providers: [FileCheck]\n})\nexport class NgFileValidatorLibModule { }\n","/*\n * Public API Surface of ng-file-validator-lib\n */\n\nexport * from './lib/ng-file-validator-lib.module';\nexport * from './lib/file-validator.service';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":";;;MAMa,SAAS;IAIpB,OAAO,eAAe,CAAC,cAAwB,EAAE;QAC/C,IAAI,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;QACf,OAAO,CAAC,OAAwB;YAC9B,IAAI,QAAQ,OAAO,CAAC,KAAK,CAAC,KAAK,QAAQ,EAAE;gBACvC,OAAO,EAAE,CAAC,IAAI,CAAC,CAAC;aACjB;YAED,IAAI,WAAW,CAAC,MAAM,GAAG,CAAC,EAAE;gBAC1B,OAAO,EAAE,CAAC,EAAE,eAAe,EAAE,IAAI,EAAE,CAAC,CAAA;aACrC;YAED,IAAI,WAAW,CAAC,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,EAAE;gBACrC,MAAM,aAAa,GAAG,WAAW,CAAC,OAAO,CAAC,KAAK,CAAC,CAAA;gBAChD,WAAW,CAAC,aAAa,CAAC,GAAG,MAAM,CAAA;aACpC;YAED,MAAM,IAAI,GAAG,OAAO,CAAC,KAAa,CAAC;YACnC,MAAM,UAAU,GAAG,IAAI,UAAU,EAAE,CAAC;YACpC,IAAI,OAAO,GAAG,EAAE,CAAA;YAChB,MAAM,KAAK,GAAG,UAAU,CAAC,MAAM,CAC7B,CAAC,QAA0C;gBACzC,UAAU,CAAC,gBAAgB,CAAC,SAAS,EAAE;oBACrC,MAAM,GAAG,GAAG,IAAI,UAAU,CAAC,UAAU,CAAC,MAAqB,CAAC,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;oBAC5E,IAAI,MAAM,GAAG,EAAE,CAAC;oBAEhB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;wBACnC,MAAM,IAAI,GAAG,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;qBAC/B;oBACD,QAAQ,MAAM;wBACZ,KAAK,UAAU;4BACb,OAAO,GAAG,KAAK,CAAA;4BACf,MAAM;wBACR,KAAK,UAAU,CAAC;wBAChB,KAAK,UAAU,CAAC;wBAChB,KAAK,UAAU,CAAC;wBAChB,KAAK,UAAU,CAAC;wBAChB,KAAK,UAAU;4BACb,OAAO,GAAG,MAAM,CAAA;4BAChB,MAAM;wBACR,KAAK,UAAU;4BACb,OAAO,GAAG,KAAK,CAAA;4BACf,MAAM;wBACR;4BAEE,OAAO,GAAG,QAAQ,CAAA;4BAClB,MAAM;qBACT;oBACD,IAAI,WAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAE;wBACjC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;qBACrB;yBAAM;wBACL,QAAQ,CAAC,IAAI,CAAC,EAAE,eAAe,EAAE,IAAI,EAAE,CAAC,CAAC;qBAC1C;oBACD,QAAQ,CAAC,QAAQ,EAAE,CAAC;iBACrB,CAAC,CAAC;gBACH,UAAU,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC;aACpC,CACF,CAAC;YACF,OAAO,KAAK,CAAC;SACd,CAAA;KACF;;;YAhEF,UAAU;;;MCEE,wBAAwB;;;YAHpC,QAAQ,SAAC;gBACR,SAAS,EAAE,CAAC,SAAS,CAAC;aACvB;;;ACND;;;;ACAA;;;;;;"}